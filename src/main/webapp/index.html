<!DOCTYPE html>
<html>
    <head>
        <title>Start Page</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <!-- JQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        
        <!-- Vue.js -->
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        
        <!-- Maps API KEY AIzaSyDnUM4ZqWUX1-sF1tuiGtMb84u3UxZTIv8 -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDnUM4ZqWUX1-sF1tuiGtMb84u3UxZTIv8"></script>
        
        <style>
            #map {
                height: 500px;
                width: 500px;
            }
        </style>
    
    </head>
  
    <body>
        <div id="map"></div>
        
        <div id="app">
            <p>{{ message }}</p>
            <table>
                <tr>
                    <th><button v-on:click="sort('id')">ID</button></th>
                    <th><button v-on:click="sort('magnitude')">MAGNITUDE</button></th>
                    <th><button v-on:click="sort('latitude')">LATITUDE</button></th>
                    <th><button v-on:click="sort('longitude')">LONGITUDE</button></th>
                    <th><button v-on:click="sort('place')">PLACE</button></th>
                    <th><button v-on:click="sort('time')">TIME</button></th>
                </tr>

                <tr v-for="earthquake in earthquakes" v-on:click="renderMap(earthquake)">
                    <td> 
                       {{ earthquake.id }}
                    </td> 

                    <td>
                        {{ earthquake.magnitude }}
                    </td>

                    <td>
                        {{ earthquake.latitude }}
                    </td>

                    <td>
                        {{ earthquake.longitude }}
                    </td>

                    <td>
                        {{ earthquake.place }}
                    </td>

                    <td>
                        {{ earthquake.time }}
                    </td> 
                </tr>

            </table>
            
        </div>
        <script>
            var app = new Vue({
                el: "#app",
                data: {
                    message: "To sort the earthquakes, select which column you would like to sort by.",
                    earthquakes : []
                },
                watch: {
                    earthquakes(){
                        this.renderMap(this.earthquakes[0]);                
                    }
                },
                methods: {
                    renderMap(earthquake)
                    {
                        var coordinates = {
                            lat : earthquake.latitude,
                            lng : earthquake.longitude
                        };
                        
                        var map_spec = {
                            center : coordinates,
                            mapTypeId : 'terrain',
                            zoom: 7
                        };

                        var map = new google.maps.Map(document.getElementById('map'), map_spec);
                        
                        var marker_spec = {
                            position: coordinates,
                            map: map
                        };

                        var marker = new google.maps.Marker(marker_spec);
                    },
                    
                    sort(method)
                    {
                        var request = "servlet?sort=" + method;
                        $.get(request, function(response){
                            app.earthquakes = response;
                        });
                    }
                }
            });
            
            $.get("servlet", function(response){
                app.earthquakes = response;
                
            });
           
        </script>
    </body>
</html>
